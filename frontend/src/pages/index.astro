---
import * as R from "remeda";
import { format } from "date-fns";
import type { MarkdownInstance } from "astro";
import type { Frontmatter, Card } from "~/types";
import Layout from "../layouts/Layout.astro";
import Card from "~/components/atoms/Card.astro";

const posts: MarkdownInstance<Frontmatter>[] = await Astro.glob<Frontmatter>("./posts/*.md");

const articles: Card[] = R.pipe(
    posts,
    R.sortBy(({ frontmatter: { createdAt } }) => -Number(createdAt)), // createdAtの降順にソート
    R.map(({ url, rawContent, frontmatter: { title, tags, createdAt, updatedAt } }) => ({
        title: title,
        url: url ?? "/",
        tags: tags ?? [],
        description: rawContent(),
        // createdAtはもともとDate型のはずなのに、そのまま渡すと
        // string型を渡すなってdate-fnsに怒られるので、インスタンス化してから渡す
        created: format(new Date(createdAt), "yyyy-MM-dd"),
        updated: updatedAt !== undefined ? format(new Date(updatedAt), "yyyy-MM-dd") : null,
    }))
);
---

<Layout title="hogeblog">
    <main>
        <a href="/">HOME</a>
        <h1>hogeblog</h1>
        <Card
            title={article.title}
            url={article.url}
            tags={["hoge", "fuga", "piyo"]}
            description={article.body}
            created={article.createdAt}
        />
    </main>
</Layout>
