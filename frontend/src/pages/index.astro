---
import * as R from "remeda";
import { format } from "date-fns";
import type { MarkdownInstance } from "astro";
import type { Frontmatter } from "~/types";
import Layout from "../layouts/Layout.astro";
import Card from "~/components/atoms/Card.astro";

const posts: MarkdownInstance<Frontmatter>[] = await Astro.glob<Frontmatter>("./posts/*.md");

type Article = {
    title: string;
    url: string;
    body: string;
    createdAt: string;
};
const articles: Article[] = R.pipe(
    posts,
    R.sortBy(({ frontmatter: { createdAt } }) => -Number(createdAt)), // createdAtの降順にソート
    R.map(({ url, rawContent, frontmatter: { title, createdAt } }) => ({
        title: title,
        url: url ?? "/",
        body: rawContent(),
        // createdAtはもともとDate型のはずなのに、そのまま渡すと
        // string型を渡すなってdate-fnsに怒られるので、インスタンス化してから渡す
        createdAt: format(new Date(createdAt), "yyyy-MM-dd"),
    }))
);

// console.log(articles);
const article = articles[0] ? articles[0] : { title: "", url: "", body: "", createdAt: "" };
---

<Layout title="hogeblog">
    <main>
        <a href="/">HOME</a>
        <h1>hogeblog</h1>
        <Card
            title={article.title}
            url={article.url}
            tags={["hoge", "fuga", "piyo"]}
            description={article.body}
            created={article.createdAt}
        />
    </main>
</Layout>
